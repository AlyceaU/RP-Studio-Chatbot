<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Real Pilates® RPTT Trainee Assistant</title>
  <style>
    :root { --rp-teal:#06655C; --rp-mint:#E6F2F0; }
    * { box-sizing: border-box; }
    body { font-family: Arial, Helvetica, sans-serif; background:#f9f9f9; margin:0; }
    header {
      background: var(--rp-teal); color:#fff; padding:12px 18px; display:flex; align-items:center; gap:12px;
      font-weight:700; letter-spacing:.3px;
    }
    header img { height:40px; width:auto; background:#fff; border-radius:6px; padding:4px; }
    main { padding:18px; }
    #card { background:#fff; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,.06); padding:16px; }
    #rp-prompts { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:14px; }
    .rpqp {
      padding:10px 14px; border:1px solid #ccc; border-radius:12px; background:#fff; cursor:pointer;
    }
    .rpqp:hover { background: var(--rp-mint); }
    #chatLog {
      height:340px; overflow:auto; padding:10px; border:1px solid #eee; border-radius:10px; background:#fafafa;
      margin-bottom:12px;
    }
    .row { margin:8px 0; }
    .me { font-weight:600; }
    .asst { font-weight:600; color:#1a1a1a; }
    #inputBar { display:flex; gap:8px; }
    #messageInput { flex:1; padding:10px 12px; border:1px solid #ccc; border-radius:10px; }
    #sendBtn { padding:10px 16px; border:1px solid var(--rp-teal); border-radius:10px; background:var(--rp-teal); color:#fff; cursor:pointer; }
    #sendBtn:disabled { opacity:.6; cursor:not-allowed; }
    @media (max-width:640px){ header img{ height:32px } #chatLog{ height:300px } }
  </style>
</head>
<body>
  <header>
    <img src="logo-rptt.png" alt="Real Pilates® Teacher Training Logo"/>
    Real Pilates® RPTT Trainee Assistant
  </header>

  <main>
    <div id="card">
      <!-- Quick Prompt Buttons -->
      <div id="rp-prompts">
        <button class="rpqp">What is the re-test policy and fee?</button>
        <button class="rpqp">How do I log self-practice hours?</button>
        <button class="rpqp">What does it mean for my academic progress if I'm behind in my hours?</button>
        <button class="rpqp">What are expectations for observation?</button>
        <button class="rpqp">How do I schedule my test-out?</button>
      </div>

      <!-- Chat area -->
      <div id="chatLog">
        <div class="row"><span class="asst">Assistant:</span> Hi! Ask me anything from the RPTT Guide.</div>
      </div>

      <!-- Input -->
      <div id="inputBar">
        <input id="messageInput" type="text" placeholder="Type your question…"/>
        <button id="sendBtn">Send</button>
      </div>
    </div>
  </main>

  <script>
    const API_URL = '/api/chat';
    const logEl = document.getElementById('chatLog');
    const inputEl = document.getElementById('messageInput');
    const sendEl = document.getElementById('sendBtn');

    function append(role, text){
      const row = document.createElement('div');
      row.className = 'row';
      const safe = String(text || '').replace(/</g,'&lt;');
      row.innerHTML = `<span class="${role==='You'?'me':'asst'}">${role}:</span> ${safe}`;
      logEl.appendChild(row);
      logEl.scrollTop = logEl.scrollHeight;
    }

    async function sendMessage(){
      const msg = (inputEl.value || '').trim();
      if(!msg) return;
      append('You', msg);
      inputEl.value = '';
      inputEl.focus();
      sendEl.disabled = true;
      try {
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ message: msg })
        });
        const data = await res.json();
        append('Assistant', data.reply || 'Sorry, no reply.');
      } catch (e){
        append('Assistant', 'Network error. Please try again.');
      } finally {
        sendEl.disabled = false;
      }
    }

    // Wire up send button and Enter key
    sendEl.addEventListener('click', sendMessage);
    inputEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter') sendMessage(); });

    // Wire up prompt buttons
    document.querySelectorAll('.rpqp').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        inputEl.value = btn.textContent;
        sendMessage();
      });
    });
  </script>
</body>
</html>
